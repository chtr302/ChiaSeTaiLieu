<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="_csrf_parameter" th:content="${_csrf.parameterName}"/>
</head>
<body>
<div th:fragment="chatbot(chatType, documentText, documentTitle)" id="chatbot-container">
    
    <div id="chatbot-trigger" class="chatbot-trigger">
        <div class="chatbot-trigger-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.955 8.955 0 01-4.126-.998L3 21l1.998-5.874A8.955 8.955 0 013 12c0-4.418 3.582-8 8-8s8 3.582 8 8z" />
            </svg>
        </div>
        <div class="chatbot-trigger-pulse"></div>
    </div>

    <!-- Chat Modal -->
    <div id="chatbot-modal" class="chatbot-modal hidden">
        <div class="chatbot-modal-content">
            
            <!-- Chat Header -->
            <div class="chatbot-header">
                <div class="chatbot-header-info">
                    <div class="chatbot-avatar">
                        <img th:src="@{/img/gemma.png}" alt="Chatbot Avatar" class="avatar-image">
                    </div>
                    <div class="chatbot-title">
                        <h3 th:text="${chatType == 'search' ? 'AI Assistant - T√¨m ki·∫øm' : 
                                      chatType == 'document' ? 'Q&A - ' + (documentTitle ?: 'T√†i li·ªáu') : 
                                      'AI Assistant PTIT'}">AI Assistant PTIT</h3>
                        <p class="chatbot-status">
                            <span class="status-dot"></span>
                            <span th:text="${chatType == 'search' ? 'S·∫µn s√†ng t√¨m ki·∫øm' : 
                                           chatType == 'document' ? 'S·∫µn s√†ng tr·∫£ l·ªùi' : 
                                           'Tr·ª±c tuy·∫øn'}">Tr·ª±c tuy·∫øn</span>
                        </p>
                    </div>
                </div>
                <div class="chatbot-controls">
                    <button id="chatbot-minimize" class="control-btn" title="Thu nh·ªè">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                        </svg>
                    </button>
                    <button id="chatbot-close" class="control-btn" title="ƒê√≥ng">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Chat Messages Area -->
            <div class="chatbot-messages" id="chatbot-messages">
                <div class="welcome-message">
                    <div class="message bot-message">
                        <div class="message-avatar"><img th:src="@{/img/gemma.png}" alt="Chatbot Avatar" class="avatar-image"></div>
                        <div class="message-content">
                            <div class="message-text" th:utext="${chatType == 'search' ? 
                                'üëã <strong>Ch√†o m·ª´ng ƒë·∫øn v·ªõi AI Search Assistant PTIT!</strong><br><br>' +
                                'üîç <strong>Kh·∫£ nƒÉng c·ªßa t√¥i:</strong><br>' +
                                '‚Ä¢ T√¨m ki·∫øm t√†i li·ªáu theo ch·ªß ƒë·ªÅ, m√¥n h·ªçc<br>' +
                                '‚Ä¢ Th·ªëng k√™ t√†i li·ªáu ph·ªï bi·∫øn nh·∫•t<br>' +
                                '‚Ä¢ G·ª£i √Ω t√†i li·ªáu ph√π h·ª£p<br>' +
                                '‚Ä¢ Ph√¢n t√≠ch xu h∆∞·ªõng t·∫£i v·ªÅ<br><br>' +
                                'üí° <em>Th·ª≠ h·ªèi: &quot;T√†i li·ªáu Java ph·ªï bi·∫øn nh·∫•t&quot;</em>' :
                                chatType == 'document' ? 
                                'üëã <strong>Xin ch√†o! T√¥i s·∫µn s√†ng tr·∫£ l·ªùi v·ªÅ t√†i li·ªáu n√†y.</strong><br><br>' +
                                'üìö <strong>B·∫°n c√≥ th·ªÉ h·ªèi:</strong><br>' +
                                '‚Ä¢ T√≥m t·∫Øt n·ªôi dung ch√≠nh<br>' +
                                '‚Ä¢ Gi·∫£i th√≠ch kh√°i ni·ªám c·ª• th·ªÉ<br>' +
                                '‚Ä¢ H∆∞·ªõng d·∫´n th·ª±c h√†nh<br>' +
                                '‚Ä¢ So s√°nh v·ªõi t√†i li·ªáu kh√°c<br><br>' +
                                'üí° <em>ƒê·∫∑t c√¢u h·ªèi c·ª• th·ªÉ ƒë·ªÉ c√≥ c√¢u tr·∫£ l·ªùi ch√≠nh x√°c!</em>' :
                                'üëã <strong>Xin ch√†o! T√¥i l√† AI Assistant PTIT.</strong><br><br>' +
                                'ü§ñ <strong>T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:</strong><br>' +
                                '‚Ä¢ T√¨m ki·∫øm th√¥ng tin h·ªçc t·∫≠p<br>' +
                                '‚Ä¢ H·ªó tr·ª£ nghi√™n c·ª©u<br>' +
                                '‚Ä¢ Gi·∫£i ƒë√°p th·∫Øc m·∫Øc<br><br>' +
                                'üí° <em>H√£y ƒë·∫∑t c√¢u h·ªèi b·∫•t k·ª≥!</em>'
                            }">
                                üëã <strong>Xin ch√†o! T√¥i l√† AI Assistant PTIT.</strong>
                            </div>
                            <div class="message-time" th:text="${#dates.format(#dates.createNow(), 'HH:mm')}"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chatbot-input-area">
                <div class="chatbot-input-container">
                    <textarea id="chatbot-input" 
                              th:placeholder="${chatType == 'search' ? 'T√¨m ki·∫øm t√†i li·ªáu, th·ªëng k√™...' : 
                                             chatType == 'document' ? 'H·ªèi v·ªÅ t√†i li·ªáu n√†y...' :
                                             'Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...'}"
                              rows="1"
                              maxlength="1000"></textarea>
                    <button id="chatbot-send" class="chatbot-send-btn" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </button>
                </div>
                <div class="input-counter">
                    <span id="char-count">0</span>/1000
                </div>
            </div>

        </div>
    </div>

    <!-- ‚úÖ JavaScript config -->
    <script th:inline="javascript">
        window.chatbotConfig = Object.assign(window.chatbotConfig || {}, {
            chatType: /*[[${chatType}]]*/ 'general',
            documentText: /*[[${documentText}]]*/ '',
            documentTitle: /*[[${documentTitle}]]*/ '',
        });
    </script>

    <!-- Load chatbot JavaScript -->
    <script th:src="@{/js/chatbot.js}"></script>

</div>
</body>
</html>