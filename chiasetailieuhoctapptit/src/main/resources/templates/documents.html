<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Studucu - Documents')"></head>
<body class="documents-page">
  <!-- Thêm div hiển thị thông báo từ server -->
  <div th:if="${successMessage}" id="successMessage" style="display: none;" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" id="errorMessage" style="display: none;" th:text="${errorMessage}"></div>  
  <!-- <div th:replace="fragments/navbar :: navbar(sinhVien=${sinhVien})"></div> -->
  <main class="main">
    <section class="documents-section">
      <div class="documents-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
          <div class="sidebar-padding"></div>
          <div class="sidebar-content">
            <div class="sidebar-header">
              <div class="user-profile">
                <img class="avatar" th:src="${sinhVien.hinhAnh}" th:alt="${sinhVien.hoVaTen}" 
                     onerror="this.src='/img/default-avatar.png'">
                <div class="user-info">
                  <p class="username" th:text="${sinhVien.hoVaTen}">Username</p>
                </div>
              </div>
            </div>
            <h2 class="sidebar-title">Categories</h2>
            <ul class="sidebar-menu">
              <li class="sidebar-item">
                <a th:href="@{/index}">
                    <i class="fas fa-home"></i> Home
                </a>
              </li>
              <li class="sidebar-item">
                <a href="javascript:void(0);">
                  <i class="fas fa-book"></i> Courses
                </a>
              </li>
              <li class="sidebar-item">
                <a href="javascript:void(0);">
                  <i class="fas fa-folder-open"></i> Library
                </a>
              </li>
              <li class="sidebar-item">
                <a href="javascript:void(0);">
                  <i class="fas fa-clock"></i> Recents
                </a>
              </li>
            </ul>
          </div>
          <div class="sidebar-footer">
            <button id="upload-btn" class="upload-button">
              <i class="fas fa-cloud-upload-alt"></i> Upload Document
            </button>
          </div>
        </div>
      
        <!-- Main Content -->
        <div class="main-content">
          <div class="content-header">
            <div class="search-area">
              <button id="menu-toggle" class="menu-toggle">
                <i class="fas fa-bars"></i>
              </button>
              <div class="search-bar">
                <input type="text" placeholder="Search for documents, courses, or topics..." class="search-input document-search">
                <i class="fas fa-search search-icon"></i>
              </div>
            </div>
          </div>
          
          <!-- Document Navigation -->
          <div class="document-navigation">
            <div class="document-tabs">
              <button class="tab-btn active" data-target="all">All Documents</button>
              <button class="tab-btn" data-target="courses">By Course</button>
              <button class="tab-btn" data-target="categories">By Type</button>
              <button class="tab-btn" data-target="featured">Most Viewed</button>
            </div>
            
            <div class="filter-dropdown">
              <button class="filter-btn">
                <i class="fas fa-filter"></i> Filter
              </button>
              <div class="filter-dropdown-content">
                <div class="filter-container">
                  <div class="filter-group">
                    <label>Semester:</label>
                    <select class="filter-select">
                      <option>Tất cả</option>
                      <option>HK1 (2023-2024)</option>
                      <option>HK2 (2023-2024)</option>
                    </select>
                  </div>
                  
                  <div class="filter-group">
                    <label>Type:</label>
                    <select class="filter-select">
                      <option>All</option>
                      <option>Lectures</option>
                      <option>Exercise</option>
                      <option>Exam</option>
                    </select>
                  </div>
                  
                  <div class="filter-group">
                    <label>Sort:</label>
                    <select class="filter-select">
                      <option>Newest</option>
                      <option>Most Viewed</option>
                      <option>Most Related</option>
                    </select>
                  </div>
                  
                  <button class="apply-filter-btn">Apply</button>
                </div>
              </div>
            </div>
          </div>
      
          <!-- Content Container -->
          <div class="content-container">
            <!-- All Documents Tab -->
            <div class="tab-content active" id="all">
              <div class="document-grid full-width">
                <!-- Document Card -->
                <div class="document-card" th:each="doc : ${Documents}">
                  <img th:if="${doc.thumbnail != null}" th:src="@{'/documents/thumbnails/' + ${doc.thumbnail}}" 
                       alt="Document Preview" class="document-image">
                  <img th:if="${doc.thumbnail == null}" src="/img/default-document.png" 
                       alt="Document Preview" class="document-image">

                  <div class="document-details">
                    <p class="document-title" th:text="${doc.tieuDe}">Document Title</p>
                    <p class="document-category" th:text="${doc.tenMon}">Category</p>
                    <p class="document-category" th:text="${doc.tenLoai}">Category</p>
                    <div class="document-stats">
                      <span class="views"><i class="fas fa-eye"></i> <span th:text="${doc.luotXem}">5.2K</span></span>
                      <div class="vote-buttons">
                        <button class="upvote-btn"><i class="fas fa-arrow-up"></i></button>
                        <span class="vote-count" th:text="${doc.danhGia}">128</span>
                        <button class="downvote-btn"><i class="fas fa-arrow-down"></i></button>
                      </div>
                      <span class="comments"><i class="fas fa-comment"></i> <span th:text="${doc.soLuongBL}">24</span></span>
                    </div>
                    <a th:href="@{'/documents/detail/' + ${doc.maTaiLieu}}" class="view-btn">Xem</a>
                    <button class="save-btn">Lưu</button>
                  </div>
                </div>
              </div>
              
              <!-- Pagination -->
              <div class="pagination">
                <button class="page-btn prev" onclick="changePage('prev')"><i class="fas fa-chevron-left"></i></button>
                <div id="page-numbers" class="page-numbers">
                  <!-- Page numbers will be dynamically generated here -->
                </div>
                <button class="page-btn next" onclick="changePage('next')"><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
            
            <!-- Courses Tab -->
            <!-- <div class="tab-content hidden" id="courses">
              <div class="courses-container">
                <div class="course-group" th:each="course : ${danhSachMonHoc}">
                  <div class="course-header">
                    <h3 class="course-name" th:text="${course.tenMon}">Course Name</h3>
                    <p class="course-info">
                      <span class="course-code" th:text="${course.maMon}">CSE123</span>
                      <span class="course-code" th:text="${course.taiLieu}">CSE123</span>
                    </p>
                  </div>
                </div>
              </div>
            </div> -->
            <div id="courses-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
              <div th:each="course : ${danhSachMonHoc}" class="course-item bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg">
                  <div class="p-5">
                      <h3 class="text-lg font-semibold text-center text-gray-800 mb-2" th:text="${course.tenMon}">Course Name</h3>
                      <p class="text-gray-600 text-sm text-center mb-3" th:text="${course.taiLieu}">Number documents</p>
                      <!-- <button class="w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition view-course-btn"
                              th:data-course="${courses.taiLieu}"> View Documents
                      </button> -->
                  </div>
              </div>
              </div>

            <div id="course-documents-view" class="hidden">
              <div class="flex items-center mb-6">
                  <button id="back-to-courses" class="mr-4 text-blue-600 hover:text-blue-800">
                      <i class="fas fa-arrow-left"></i> Back to Courses
                  </button>
                  <h2 id="course-title" class="text-2xl font-bold text-gray-800">Course Documents</h2>
              </div>

              <div id="course-documents-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  </div>
            </div>

            <!-- Featured Tab -->
            <div class="tab-content hidden" id="featured">
              <div class="document-grid full-width">
                <p th:if="${mostViewedDocuments == null}" class="empty-message">No featured documents available.</p>
                
                <div class="document-card" th:if="${mostViewedDocuments != null}" th:each="doc : ${mostViewedDocuments}">
                  <img th:src="@{'/img/default-document.png'}" alt="Document Preview" class="document-image">
                  <div class="document-details">
                    <p class="document-title" th:text="${doc.title}">Document Title</p>
                    <p class="document-category" th:text="${doc.category}">Category</p>
                    <div class="document-stats">
                      <span class="views"><i class="fas fa-eye"></i> <span th:text="${doc.views}">10.5K</span></span>
                      <div class="vote-buttons">
                        <button class="upvote-btn"><i class="fas fa-arrow-up"></i></button>
                        <span class="vote-count" th:text="${doc.voteCount}">245</span>
                        <button class="downvote-btn"><i class="fas fa-arrow-down"></i></button>
                      </div>
                      <span class="comments"><i class="fas fa-comment"></i> <span th:text="${doc.commentCount}">42</span></span>
                    </div>
                    <button class="view-btn">Xem</button>
                    <button class="save-btn">Lưu</button>
                  </div>
                </div>
              </div>
              
              <!-- Pagination -->
              <div class="pagination">
                <button class="page-btn prev"><i class="fas fa-chevron-left"></i></button>
                <div class="page-numbers">
                  <button class="page-btn active">1</button>
                  <button class="page-btn">2</button>
                  <button class="page-btn">3</button>
                  <span class="page-ellipsis">...</span>
                  <button class="page-btn">10</button>
                </div>
                <button class="page-btn next"><i class="fas fa-chevron-right"></i></button>
              </div>
            </div>
            
            <!-- Categories Tab -->
            <div class="tab-content hidden" id="categories">
              <div class="categories-container">
                <p>Categories content here</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Upload Modal -->
  <div id="upload-modal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">Upload Document</h3>
        <button id="close-modal" class="modal-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <form id="upload-form" th:action="@{/documents/upload}" method="post" enctype="multipart/form-data">
          <div class="file-upload">
            <input type="file" id="file-input" name="file" class="file-input" accept=".pdf" required>
            <div class="upload-default">
              <i class="fas fa-cloud-upload-alt"></i>
              <p class="upload-title">Nhấp vào đây hoặc kéo thả file PDF</p>
              <p class="upload-description">Chỉ chấp nhận định dạng PDF (tối đa 50MB)</p>
            </div>
            <div class="file-preview" id="file-preview" style="display: none;"></div>
          </div>
          <div class="form-section">
            <div class="form-group">
              <label for="tieuDe" class="form-label">Title <span class="required">*</span></label>
              <input type="text" id="tieuDe" name="tieuDe" placeholder="Document title" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="maLoai" class="form-label">Category <span class="required">*</span></label>
              <select id="maLoai" name="maLoai" class="form-control" required>
                <option value="">Select a category</option>
                <option th:each="loaiTaiLieu : ${loaiTaiLieu}"
                        th:value="${loaiTaiLieu.maLoai}" 
                        th:text="${loaiTaiLieu.tenLoai}">Category Name</option>
              </select>
            </div>
            <div class="form-group">
              <label for="maMonHoc" class="form-label">Course <span class="required">*</span></label>
              <select id="maMonHoc" name="maMonHoc" class="form-control" required>
                <option value="">Select a course</option>
                <option th:each="monHoc : ${danhSachMonHoc}"
                        th:value="${monHoc.maMon}" 
                        th:text="${monHoc.tenMon}">Course Name</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tags" class="form-label">Tags</label>
              <input type="text" id="tags" name="tags" placeholder="e.g. python, ai, notes (separated by commas)" class="form-control">
            </div>
            <div class="form-group">
              <label for="moTa" class="form-label">Description <span class="required">*</span></label>
              <textarea id="moTa" name="moTa" rows="4" placeholder="Describe your document" class="form-control" required></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancel-upload" class="btn-cancel">Cancel</button>
            <button type="submit" id="save-upload" class="btn-save"><i class="fas fa-save"></i> Upload</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <div th:replace="fragments/scripts :: scripts"></div>
  <link th:href="@{/css/documents.css}" rel="stylesheet">
  <script th:src="@{/js/document.js}"></script>
</body>
</html>